!function(t,i,s){"use strict";i.module("spotify",[]).provider("Spotify",function(){var s={};s.clientId=null,s.secret=null,s.redirectUri=null,s.scope=null,s.authToken=null,this.setClientId=function(t){return s.clientId=t,s.clientId},this.getClientId=function(){return s.clientId},this.setSecret=function(t){return s.secret=t,s.secret},this.getSecret=function(){return s.secret},this.setAuthToken=function(t){return s.authToken=t,s.authToken},this.setRedirectUri=function(t){return s.redirectUri=t,s.redirectUri},this.getRedirectUri=function(){return s.redirectUri},this.setScope=function(t){return s.scope=t,s.scope};var n={};n.toQueryString=function(t){var s=[];return i.forEach(t,function(t,i){this.push(encodeURIComponent(i)+"="+encodeURIComponent(t))},s),s.join("&")},s.apiBase="https://api.spotify.com/v1",this.$get=["$q","$http","$window",function(e,r,u){function o(){this.clientId=s.clientId,this.redirectUri=s.redirectUri,this.apiBase=s.apiBase,this.scope=s.scope,this.authToken=s.authToken,this.toQueryString=n.toQueryString}function a(i,s,n,e){var r=t.open(i,s,n),u=t.setInterval(function(){try{r&&!r.closed||(t.clearInterval(u),e(r))}catch(t){}},1e3);return r}return o.prototype={api:function(t,i,s,n,u){var o=e.defer();return r({url:this.apiBase+t,method:i||"GET",params:s,data:n,headers:u,withCredentials:!1}).then(function(t){o.resolve(t)}).catch(function(t){o.reject(t)}),o.promise},_auth:function(t){var i={Authorization:"Bearer "+this.authToken};return t&&(i["Content-Type"]="application/json"),i},getAlbum:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t)},getAlbums:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/albums","GET",{ids:t?t.toString():""})},getAlbumTracks:function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/albums/"+t+"/tracks","GET",i)},getArtist:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t)},getArtists:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/artists/","GET",{ids:t?t.toString():""})},getArtistAlbums:function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/albums","GET",i,null,this._auth())},getArtistTopTracks:function(t,i){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/top-tracks","GET",{country:i})},getRelatedArtists:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/artists/"+t+"/related-artists")},getFeaturedPlaylists:function(t){return this.api("/browse/featured-playlists","GET",t,null,this._auth())},getNewReleases:function(t){return this.api("/browse/new-releases","GET",t,null,this._auth())},getCategories:function(t){return this.api("/browse/categories","GET",t,null,this._auth())},getCategory:function(t,i){return this.api("/browse/categories/"+t,"GET",i,null,this._auth())},getCategoryPlaylists:function(t,i){return this.api("/browse/categories/"+t+"/playlists","GET",i,null,this._auth())},getRecommendations:function(t){return this.api("/recommendations","GET",t,null,this._auth())},getAvailableGenreSeeds:function(){return this.api("/recommendations/available-genre-seeds","GET",null,null,this._auth())},following:function(t,i){return i=i||{},i.type=t,this.api("/me/following","GET",i,null,this._auth())},follow:function(t,i){return this.api("/me/following","PUT",{type:t,ids:i},null,this._auth())},unfollow:function(t,i){return this.api("/me/following","DELETE",{type:t,ids:i},null,this._auth())},userFollowingContains:function(t,i){return this.api("/me/following/contains","GET",{type:t,ids:i},null,this._auth())},followPlaylist:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i+"/followers","PUT",null,{public:s||null},this._auth(!0))},unfollowPlaylist:function(t,i){return this.api("/users/"+t+"/playlists/"+i+"/followers","DELETE",null,null,this._auth())},playlistFollowingContains:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i+"/followers/contains","GET",{ids:s.toString()},null,this._auth())},getSavedUserTracks:function(t){return this.api("/me/tracks","GET",t,null,this._auth())},userTracksContains:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/tracks/contains","GET",{ids:t.toString()},null,this._auth())},saveUserTracks:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/tracks","PUT",{ids:t.toString()},null,this._auth())},removeUserTracks:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/tracks","DELETE",{ids:t.toString()},null,this._auth(!0))},saveUserAlbums:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/albums","PUT",{ids:t.toString()},null,this._auth())},getSavedUserAlbums:function(t){return this.api("/me/albums","GET",t,null,this._auth())},removeUserAlbums:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/albums","DELETE",{ids:t.toString()},null,this._auth(!0))},userAlbumsContains:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/me/albums/contains","GET",{ids:t.toString()},null,this._auth())},getUserTopArtists:function(t){return t=t||{},this.api("/me/top/artists","GET",t,null,this._auth())},getUserTopTracks:function(t){return t=t||{},this.api("/me/top/tracks","GET",t,null,this._auth())},getUserPlaylists:function(t,i){return this.api("/users/"+t+"/playlists","GET",i,null,{Authorization:"Bearer "+this.authToken})},getPlaylist:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i,"GET",s,null,this._auth())},getPlaylistTracks:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i+"/tracks","GET",s,null,this._auth())},createPlaylist:function(t,i){return this.api("/users/"+t+"/playlists","POST",null,i,this._auth(!0))},addPlaylistTracks:function(t,s,n,e){return n=i.isArray(n)?n:n.split(","),i.forEach(n,function(t,i){n[i]=-1===t.indexOf("spotify:")?"spotify:track:"+t:t}),this.api("/users/"+t+"/playlists/"+s+"/tracks","POST",{uris:n.toString(),position:e?e.position:null},null,this._auth(!0))},removePlaylistTracks:function(t,s,n){n=i.isArray(n)?n:n.split(",");var e;return i.forEach(n,function(t,i){e=n[i],n[i]={uri:-1===e.indexOf("spotify:")?"spotify:track:"+e:e}}),this.api("/users/"+t+"/playlists/"+s+"/tracks","DELETE",null,{tracks:n},this._auth(!0))},reorderPlaylistTracks:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i+"/tracks","PUT",null,s,this._auth(!0))},replacePlaylistTracks:function(t,s,n){n=i.isArray(n)?n:n.split(",");var e;return i.forEach(n,function(t,i){e=n[i],n[i]=-1===e.indexOf("spotify:")?"spotify:track:"+e:e}),this.api("/users/"+t+"/playlists/"+s+"/tracks","PUT",{uris:n.toString()},null,this._auth(!0))},updatePlaylistDetails:function(t,i,s){return this.api("/users/"+t+"/playlists/"+i,"PUT",null,s,this._auth(!0))},getUser:function(t){return this.api("/users/"+t)},getCurrentUser:function(){return this.api("/me","GET",null,null,this._auth())},search:function(t,i,s){return s=s||{},s.q=t,s.type=i,this.api("/search","GET",s,null,this._auth())},getTrack:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/tracks/"+t)},getTracks:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/tracks/","GET",{ids:t?t.toString():""})},getTrackAudioFeatures:function(t){return t=-1===t.indexOf("spotify:")?t:t.split(":")[2],this.api("/audio-features/"+t,"GET",null,null,this._auth())},getTracksAudioFeatures:function(t){return t=i.isString(t)?t.split(","):t,i.forEach(t,function(i,s){t[s]=i.indexOf("spotify:")>-1?i.split(":")[2]:i}),this.api("/audio-features/","GET",{ids:t?t.toString():""},null,this._auth())},setAuthToken:function(t){return this.authToken=t,this.authToken},noLogin:function(){var t=e.defer();return r({url:"https://accounts.spotify.com/api/token",method:"POST",data:{grant_type:"client_credentials"},headers:{Authorization:"Basic "+btoa(this.clientId+":"+this.secret),"Content-Type":"application/x-www-form-urlencoded","Access-Control-Allow-Origin":"*"},withCredentials:!1}).then(function(i){return t.resolve(i)}).catch(function(i){return t.reject(i)}),t.promise},login:function(){function t(n){"spotify-token"===n.key&&(c&&c.close(),l=!0,s.setAuthToken(n.newValue),u.removeEventListener("storage",t,!1),i.resolve(n.newValue))}var i=e.defer(),s=this,n=screen.width/2-200,r=screen.height/2-250,o={client_id:this.clientId,redirect_uri:this.redirectUri,scope:this.scope||"",response_type:"token"},l=!1,c=a("https://accounts.spotify.com/authorize?"+this.toQueryString(o),"Spotify","menubar=no,location=no,resizable=yes,scrollbars=yes,status=no,width=400,height=500,top="+r+",left="+n,function(){l||i.reject()});return u.addEventListener("storage",t,!1),i.promise}},new o}]})}(window,angular);